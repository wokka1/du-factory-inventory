{
    "slots":{
        "0":{"name":"slot1","type":{"events":[],"methods":[]}},
        "1":{"name":"slot2","type":{"events":[],"methods":[]}},
        "2":{"name":"slot3","type":{"events":[],"methods":[]}},
        "3":{"name":"slot4","type":{"events":[],"methods":[]}},
        "4":{"name":"slot5","type":{"events":[],"methods":[]}},
        "5":{"name":"slot6","type":{"events":[],"methods":[]}},
        "6":{"name":"slot7","type":{"events":[],"methods":[]}},
        "7":{"name":"slot8","type":{"events":[],"methods":[]}},
        "8":{"name":"slot9","type":{"events":[],"methods":[]}},
        "9":{"name":"slot10","type":{"events":[],"methods":[]}},
        "-1":{"name":"unit","type":{"events":[],"methods":[]}},
        "-2":{"name":"construct","type":{"events":[],"methods":[]}},
        "-3":{"name":"player","type":{"events":[],"methods":[]}},
        "-4":{"name":"system","type":{"events":[],"methods":[]}},
        "-5":{"name":"library","type":{"events":[],"methods":[]}}
    },
    "handlers":[
        {"code":"local debugIndex = 0\nlocal function debugPrint(msg)\n    if screen then\n        screen.addText(0, debugIndex * 2.5, 2.5, msg)\n        debugIndex = debugIndex + 1\n    end\n    system.print(msg)\nend\n\n_G.startTime = system.getArkTime()\n_G.debugPrint = debugPrint\n_G.eventFired = false\n_G.heartbeatCount = 0\n_G.retriedOnce = false\n\nlocal function getElapsed()\n    return string.format(\"%.1f\", system.getArkTime() - _G.startTime)\nend\n_G.getElapsed = getElapsed\n\nlocal container = nil\nfor slot_name, slot in pairs(unit) do\n    if slot_name == \"slot2\" then\n        if type(slot) == \"table\" and slot.getClass then\n            local className = slot.getClass()\n            if string.match(className, \"Container\") then\n                container = slot\n                break\n            end\n        end\n    end\nend\n\nif not container then\n    debugPrint(\"ERROR: No container in slot2\")\n    unit.exit()\nend\n\n_G.container = container\nlocal id = container.getLocalId()\n\ndebugPrint(\"===================================\")\ndebugPrint(\"TIMING TEST - Single Container\")\ndebugPrint(\"Testing slot2 (ID \" .. id .. \")\")\ndebugPrint(\"===================================\")\ndebugPrint(\"\")\n\n-- Step 1: First updateContent() call\ndebugPrint(\"[\" .. getElapsed() .. \"s] STEP 1: First updateContent() call\")\nlocal result1 = container.updateContent()\nif result1 and result1 > 0 then\n    debugPrint(\"[\" .. getElapsed() .. \"s] Result: COOLDOWN \" .. string.format(\"%.2f\", result1) .. \"s\")\n    local waitTime = math.ceil(result1) + 1\n    debugPrint(\"[\" .. getElapsed() .. \"s] Will wait \" .. waitTime .. \"s and retry\")\n    debugPrint(\"\")\n    unit.setTimer(\"retry\", waitTime)\nelse\n    debugPrint(\"[\" .. getElapsed() .. \"s] Result: ACCEPTED (\" .. tostring(result1) .. \")\")\n    debugPrint(\"[\" .. getElapsed() .. \"s] Waiting for onContentUpdate event...\")\n    debugPrint(\"\")\n    unit.setTimer(\"timeout\", 120)\nend\n\nunit.setTimer(\"heartbeat\", 5)\n","filter":{"args":[],"signature":"onStart()","slotKey":"-1"},"key":"0"},
        {"code":"if _G.retriedOnce then\n    return\nend\n_G.retriedOnce = true\nunit.stopTimer(\"retry\")\n\nlocal elapsed = _G.getElapsed()\n_G.debugPrint(\"[\" .. elapsed .. \"s] STEP 2: Second updateContent() call (after cooldown)\")\n\nlocal result2 = _G.container.updateContent()\nif result2 and result2 > 0 then\n    _G.debugPrint(\"[\" .. elapsed .. \"s] Result: COOLDOWN \" .. string.format(\"%.2f\", result2) .. \"s\")\n    _G.debugPrint(\"[\" .. elapsed .. \"s] WARNING: Still on cooldown after waiting!\")\n    _G.debugPrint(\"[\" .. elapsed .. \"s] This confirms calling updateContent() during cooldown resets timer\")\nelse\n    _G.debugPrint(\"[\" .. elapsed .. \"s] Result: ACCEPTED (\" .. tostring(result2) .. \")\")\nend\n\n_G.debugPrint(\"[\" .. elapsed .. \"s] Waiting for onContentUpdate event (max 120s)...\")\n_G.debugPrint(\"\")\n\nunit.setTimer(\"timeout\", 120)","filter":{"args":[{"value":"retry"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"1"},
        {"code":"_G.heartbeatCount = _G.heartbeatCount + 1\nlocal elapsed = _G.getElapsed()\n\nif _G.heartbeatCount % 2 == 0 then\n    _G.debugPrint(\"[\" .. elapsed .. \"s] ... heartbeat (\" .. _G.heartbeatCount * 5 .. \"s elapsed)\")\nend\n\nif not _G.eventFired then\n    unit.setTimer(\"heartbeat\", 5)\nend","filter":{"args":[{"value":"heartbeat"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"2"},
        {"code":"local elapsed = _G.getElapsed()\n_G.debugPrint(\"\")\n_G.debugPrint(\"[\" .. elapsed .. \"s] === TIMEOUT ===\")\n_G.debugPrint(\"[\" .. elapsed .. \"s] No onContentUpdate event received\")\n_G.debugPrint(\"[\" .. elapsed .. \"s] Event system may be broken for this container\")\n_G.debugPrint(\"\")\nunit.exit()","filter":{"args":[{"value":"timeout"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"3"},
        {"code":"_G.eventFired = true\nlocal elapsed = _G.getElapsed()\n_G.debugPrint(\"\")\n_G.debugPrint(\"[\" .. elapsed .. \"s] !!! onContentUpdate EVENT FIRED !!!\")\n_G.debugPrint(\"[\" .. elapsed .. \"s] SUCCESS: Event system is working\")\n\nlocal items = _G.container.getContent()\n_G.debugPrint(\"[\" .. elapsed .. \"s] Items retrieved: \" .. #items)\n\nif #items > 0 then\n    for _, item in pairs(items) do\n        local itemData = system.getItem(item.id)\n        _G.debugPrint(\"[\" .. elapsed .. \"s]   - \" .. itemData.displayName .. \" x\" .. item.quantity)\n    end\nend\n\n_G.debugPrint(\"\")\n_G.debugPrint(\"[\" .. elapsed .. \"s] === TEST COMPLETE ===\")\nunit.exit()","filter":{"args":[],"signature":"onContentUpdate()","slotKey":"1"},"key":"4"}
    ],
    "methods":[],
    "events":[]
}
